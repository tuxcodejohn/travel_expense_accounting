%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Header Area

\documentclass[a4paper,10pt]{scrartcl}

\usepackage{a4wide}
\usepackage[ngerman]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{textcomp}
\usepackage[table]{xcolor}
\usepackage{hhline}
\usepackage{tabularx}
\usepackage{tabu}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{datetime}
\usepackage{fp}

%\usepackage{showframe}

\usepackage{lmodern}
\renewcommand{\familydefault}{\sfdefault}

\definecolor{OrtGray}{gray}{0.75}
\newcommand{\spcell}[2][c]{%
	\begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}

\setlength\LTleft{0pt}
\setlength\LTright{0pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Configuration Area

\def \TravName      { Handels Reisender } % Travelers name
\def \TravTarget    { Münchhausen }       % Travelers target
\def \TravStartedOn { \formatdate{01}{01}{2014} } % date of start
\def \TravStartedAt { \formattime{08}{45}{00} }   % time of start
\def \TravEndedOn   { \formatdate{05}{01}{2014} } % date of end
\def \TravEndedAt   { \formattime{18}{15}{00} }   % time of end
\def \TravReason    { Inbetriebnahme Automatisierung. Kann ein sehr langer Text sein. }
\def \TravProjNr    { PRJ001 }

\FPset{NrShortDays}  {2} % >8h <24h
\FPset{NrFullDays}   {3} % =24h
\FPset{NrBreakfasts} {4} % Nr of days you got free breakfast
\FPset{NrLunches}    {1} % Nr of days you got free lunch

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fees

\FPset{FeeShortDay}      {12}
\FPset{FeeFullDay}       {24}
\FPset{FeePercBreakfast} {0.2}
\FPset{FeePercLunch}     {0.4}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Caculations

\FPeval{FeeBreakfast}{trunc((-1*FeeFullDay*FeePercBreakfast):2)}
\FPeval{FeeLunch}{trunc((-1*FeeFullDay*FeePercLunch):2)}

\FPeval{AbsoluteShortDays}{trunc((FeeShortDay*NrShortDays):2)}
\FPeval{AbsoluteFullDays}{trunc((FeeFullDay*NrFullDays):2)}
\FPeval{AbsoluteBreakfasts}{trunc((FeeBreakfast*NrBreakfasts):2)}
\FPeval{AbsoluteLunches}{trunc((FeeLunch*NrLunches):2)}
\FPeval{SumFare}{trunc((AbsoluteShortDays+AbsoluteFullDays+AbsoluteBreakfasts+AbsoluteLunches):2)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Document Area

\title{Reisekostenabrechnung}
\author{\TravName}
\date{\today}

\begin{document}


\begin{table}
	\begin{tabularx}{\textwidth}{lXlX}
	\textbf{Reisender:}                  & \multicolumn{3}{l}{ \TravName }                     \\
	\textbf{Reiseziel:}                  & \multicolumn{3}{l}{ \TravTarget }                   \\
	\textbf{Reisebeginn:}                & \TravStartedOn & \textbf{Uhrzeit:} & \TravStartedAt \\
	\textbf{Reiseende:}                  & \TravEndedOn   & \textbf{Uhrzeit:} & \TravEndedAt   \\
        \textbf{Reisezweck:}                 & \multicolumn{3}{l}{ \TravReason }                   \\
	\textbf{Verkaufsauftr./Projekt-Nr.:} & \multicolumn{3}{l}{ \TravProjNr }
	\end{tabularx}
\end{table}

\begin{longtabu} to 0.94\linewidth {|c|c|X|c|c|c|} % FIXME why is \linewidth or \textwidth bigger than the page???

\hline

\multicolumn{6}{|l|}{\textbf{Verpflegung pro Kalendertag}} \\
\hline
\taburowcolors 1 {OrtGray .. OrtGray}
~ & Anzahl Tage   & Pauschale             & \spcell{Pauschale \\ {[\texteuro]}} & ~ & \spcell{Betrag \\ {[\texteuro]}}	\\ \hline
\taburowcolors 1 {white .. white}
~ & \NrShortDays  & 8:01 -- 23:59 Stunden & \FeeShortDay                        & ~ & \AbsoluteShortDays                \\ \tabucline{1-5}
~ & \NrFullDays   & 24 Stunden            & \FeeFullDay                         & ~ & \AbsoluteFullDays                 \\ \tabucline{1-5}
~ & ~             & ~                     & ~                                   & ~ & ~                                 \\ \tabucline{1-5}
~ & \NrBreakfasts & Frühstück             & \FeeBreakfast                       & ~ & \AbsoluteBreakfasts               \\ \tabucline{1-5}
~ & \NrLunches    & Mittagessen           & \FeeLunch                           & ~ & \AbsoluteLunches                  \\ 
\hline
\taburowcolors 1 {OrtGray .. OrtGray}
\multicolumn{3}{|l}{\parbox[t]{7cm}{Der VMA wird nach Prüfung mit der nächsten Gehaltsabrechnung überwiesen.}} & \multicolumn{1}{r}{ \textbf{Summe VMA:} } & \multicolumn{2}{r|}{ \textbf{\SumFare \texteuro} } \\ 
\taburowcolors 1 {white .. white}

\hline

\multicolumn{6}{l}{ ~ } \\

\hline
\multicolumn{6}{|l|}{\textbf{Übernachtung}} \\
\hline
\taburowcolors 1 {OrtGray .. OrtGray}
\# & Anzahl & Beschreibung & Datum & \spcell{Urspr.währung \\ ~ } & \spcell{Betrag \\ {[\texteuro]}} \\ \hline
\taburowcolors 1 {white .. white}
1  & ~      & ~            & ~     & ~                            & ~                                \\ \tabucline{1-5}
2  & ~      & ~            & ~     & ~                            & ~                                \\ \tabucline{1-5}
3  & ~      & ~            & ~     & ~                            & ~                                \\ 

\hline

\multicolumn{6}{|l|}{\textbf{Fahrtkosten privater PKW}} \\
\hline
\taburowcolors 1 {OrtGray .. OrtGray}
\# & \spcell{Strecke \\ {[km]}} & Beschreibung & Datum & \spcell{Km Satz \\ {[\texteuro]/km}} & \spcell{Betrag \\ {[\texteuro]}} \\ \hline
\taburowcolors 1 {white .. white}
1  & ~                          & ~            & ~     & ~                                   & ~                                \\ \tabucline{1-5}
2  & ~                          & ~            & ~     & ~                                   & ~                                \\ \tabucline{1-5}
3  & ~                          & ~            & ~     & ~                                   & ~                                \\ \hline

\multicolumn{6}{|l|}{\textbf{Weitere Belege}} \\
\hline
\taburowcolors 1 {OrtGray .. OrtGray}
\# & Firma & Beschreibung & Datum & \spcell{Urspr.währung \\ ~ } & \spcell{Betrag \\ {[\texteuro]}} \\ \hline
\taburowcolors 1 {white .. white}
1  & ~     & ~            & ~     & ~                            & ~                                \\ \tabucline{1-5}
2  & ~     & ~            & ~     & ~                            & ~                                \\ \tabucline{1-5}
3  & ~     & ~            & ~     & ~                            & ~                                \\ 

\hline

\hline
\hline


\taburowcolors 1 {OrtGray .. OrtGray}
\multicolumn{6}{|l|}{ ~ } \\
\multicolumn{4}{|r}{ \textbf{Summe Übernachtungen} } & \multicolumn{2}{r|}{ \textbf{0,00 \texteuro} } \\
\multicolumn{4}{|r}{ \textbf{Summe Fahrtkosten Privat PKW} } & \multicolumn{2}{r|}{ \textbf{0,00 \texteuro} } \\
\multicolumn{4}{|r}{ \textbf{Summe Belege} } & \multicolumn{2}{r|}{ \textbf{0,00 \texteuro} } \\
\multicolumn{4}{|r}{ \textbf{Vorschuss} } & \multicolumn{2}{r|}{ \textbf{0,00 \texteuro} } \\ \tabucline[OrtGray]{1-3}\noalign{\kern-\arrayrulewidth} \tabucline{4-6}
\multicolumn{4}{|r}{ \textbf{Summe Belege} } & \multicolumn{2}{r|}{ \textbf{0,00 \texteuro} } \\ \tabucline[OrtGray]{1-3}\noalign{\kern-\arrayrulewidth} \tabucline{4-6}
\multicolumn{6}{|l|}{ Die Summe der Belege wird nach Prüfung beim nächsten Überweisungstermin angewiesen. } \\

\hline
\taburowcolors 1 {white .. white}
\multicolumn{6}{l}{ ~ } \\
\hline

\taburowcolors 1 {OrtGray .. OrtGray}
\multicolumn{6}{|l|}{ ~ } \\
\multicolumn{3}{|r}{ \textbf{Bestätigung der Summe durch den Reisenden} } & \multicolumn{3}{r|}{ ~ } \\ \tabucline[OrtGray]{1-3}\noalign{\kern-\arrayrulewidth} \tabucline{4-6}
\multicolumn{3}{|r}{ ~ } & \multicolumn{1}{l}{ \emph{Ort/Datum} } & \multicolumn{2}{r|}{ \emph{Unterschrift} } \\
\multicolumn{6}{|l|}{ ~ } \\
\hline
\end{longtabu}

\end{document}
